(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{611:function(a,s,t){"use strict";t.r(s);var e=t(13),n=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"从零开始搭建一条jenkins自动化部署流水线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从零开始搭建一条jenkins自动化部署流水线"}},[a._v("#")]),a._v(" 从零开始搭建一条jenkins自动化部署流水线")]),a._v(" "),t("h2",{attrs:{id:"_0-前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[a._v("#")]),a._v(" 0. 前言")]),a._v(" "),t("p",[a._v("本次流水线搭建目标实现:   代码检查-代码打包-部署 三步自动化.")]),a._v(" "),t("h2",{attrs:{id:"_1-环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境搭建"}},[a._v("#")]),a._v(" 1. 环境搭建")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("服务器: 一台centos7.8虚拟机, IP: 192.168.58.132")]),a._v(" "),t("blockquote",[t("p",[a._v("本地调试用, 一台就够, 资源充足可以多台")])])]),a._v(" "),t("li",[t("p",[a._v("环境: "),t("code",[a._v("jdk1.8")]),a._v(", "),t("code",[a._v("maven3.5.2")]),a._v(", "),t("code",[a._v("jenkins2.289.1")]),a._v(", "),t("code",[a._v("sonarqube8.2")]),a._v(", "),t("code",[a._v("docker")]),a._v(", "),t("code",[a._v("docker-copmpose")])])])]),a._v(" "),t("h3",{attrs:{id:"_1-1-安装jdk"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装jdk"}},[a._v("#")]),a._v(" 1.1 安装jdk")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -y java-1.8.0-openjdk-devel.x86_64\njava -version\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h3",{attrs:{id:"_1-2-安装maven"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装maven"}},[a._v("#")]),a._v(" 1.2 安装maven")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://repos.fedorapeople.org"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". -O /etc/yum.repos.d/epel-apache-maven.repo\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo -O /etc/yum.repos.d/epel-apache-maven.repo\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" apache-maven\nmvn -v\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("h3",{attrs:{id:"_1-3-安装git"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装git"}},[a._v("#")]),a._v(" 1.3 安装git")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("h3",{attrs:{id:"_1-4-安装jenkins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-安装jenkins"}},[a._v("#")]),a._v(" 1.4 安装jenkins")]),a._v(" "),t("p",[a._v("这里直接使用war启动jenkins , 可以使用"),t("code",[a._v("java -jar")]),a._v("命令, 也可以使用tomcat启动. 这次我用的是tomcat")]),a._v(" "),t("blockquote",[t("p",[a._v("jenkins.war"),t("a",{attrs:{href:"https://get.jenkins.io/war-stable/2.289.2/jenkins.war",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),t("OutboundLink")],1)])]),a._v(" "),t("p",[a._v("启动后访问"),t("a",{attrs:{href:"http://192.168.58.132:8080/jenkins",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132:8080/jenkins"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("插件直接安装jenkins建议安装的插件, 如果有安装失败就重启jenkins几次.")]),a._v(" "),t("p",[a._v("默认密码在/var/jenkins_home/secrets/initialAdminPassword,  直接cat获取")]),a._v(" "),t("h3",{attrs:{id:"_1-5-安装sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-安装sonarqube"}},[a._v("#")]),a._v(" 1.5 安装sonarqube")]),a._v(" "),t("p",[a._v("先安装docker和docker-compose")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\t\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" systemctl start "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" -L https://download.fastgit.org/docker/compose/releases/download/1.27.4/docker-compose-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -s"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-"),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" -m"),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" version\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" -v\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("再启动sonarqube")]),a._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3.7"')]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonarqube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("8.2"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("community\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9000:9000"')]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("postgresql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//db"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5432/sonar\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_USERNAME")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/data\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_extensions"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/extensions\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_logs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/logs\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_temp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/temp\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("db")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" postgres\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("POSTGRES_USER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("POSTGRES_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" postgresql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/postgresql\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" postgresql_data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/postgresql/data\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarnet")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n     \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_extensions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_temp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("postgresql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("postgresql_data")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br"),t("span",{staticClass:"line-number"},[a._v("40")]),t("br"),t("span",{staticClass:"line-number"},[a._v("41")]),t("br")])]),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up -d\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("blockquote",[t("p",[a._v("如果启动几秒后发现sonarqube报错: "),t("code",[a._v("max virtual memory areas vm.max_map_count [65530] is too low, increase to at least")]),a._v("执行以下命令然后重启容器")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("sysctl -w vm.max_map_count"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("262144")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])])]),a._v(" "),t("h4",{attrs:{id:"汉化sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#汉化sonarqube"}},[a._v("#")]),a._v(" 汉化sonarqube")]),a._v(" "),t("p",[a._v("先下载汉化包插件"),t("a",{attrs:{href:"https://image.ytg2097.com/sonar-l10n-zh-plugin-1.16.jar",target:"_blank",rel:"noopener noreferrer"}},[a._v("点我获取"),t("OutboundLink")],1)]),a._v(" "),t("p",[a._v("查找sonarqube插件的挂载路径, docker默认卷存放位置在/var/lib/docker/volumes/下, 如果按照上述安装步骤一直进行的话, sonarqube容器的插件包路径应该在宿主机的"),t("code",[a._v("/var/lib/docker/volumes/sonar_sonarqube_extensions/_data/plugins")]),a._v("下, 将下载好的jar放着这里")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701170352931.png",alt:"image-20210701170352931"}})]),a._v(" "),t("p",[a._v("然后重启再次访问"),t("a",{attrs:{href:"http://192.168.58.132/9000",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132/9000"),t("OutboundLink")],1),a._v(", 可以看到汉化成功")]),a._v(" "),t("h2",{attrs:{id:"_2-配置jenkins"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置jenkins"}},[a._v("#")]),a._v(" 2.配置jenkins")]),a._v(" "),t("h3",{attrs:{id:"_2-1-下载插件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-下载插件"}},[a._v("#")]),a._v(" 2.1 下载插件")]),a._v(" "),t("p",[a._v("进入插件"),t("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/pluginManager/available",target:"_blank",rel:"noopener noreferrer"}},[a._v("搜索页面"),t("OutboundLink")],1),a._v(", 分别搜索gitee, sonarqube scanner, Config File Provider, 然后安装")]),a._v(" "),t("h3",{attrs:{id:"_2-2-新增maven-settings文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-新增maven-settings文件"}},[a._v("#")]),a._v(" 2.2 新增maven settings文件")]),a._v(" "),t("p",[a._v("进入"),t("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configfiles/selectProvider",target:"_blank",rel:"noopener noreferrer"}},[a._v("配置文件管理页面"),t("OutboundLink")],1),a._v(", 选择Maven settings.xml, 然后submit, 在编辑页面里的content框中粘贴进去你的settings.xml配置然后submit")]),a._v(" "),t("h3",{attrs:{id:"_2-3-全局配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-全局配置"}},[a._v("#")]),a._v(" 2.3 全局配置")]),a._v(" "),t("p",[a._v("进入"),t("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configureTools/",target:"_blank",rel:"noopener noreferrer"}},[a._v("全局工具配置页面"),t("OutboundLink")],1)]),a._v(" "),t("h4",{attrs:{id:"_2-3-1-配置java"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-配置java"}},[a._v("#")]),a._v(" 2.3.1 配置java")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172410009.png",alt:"image-20210701172410009"}})]),a._v(" "),t("h4",{attrs:{id:"_2-3-2-配置git"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-配置git"}},[a._v("#")]),a._v(" 2.3.2 配置git")]),a._v(" "),t("p",[a._v("git直接默认配置就好")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172526943.png",alt:"image-20210701172526943"}})]),a._v(" "),t("h4",{attrs:{id:"_2-3-3-配置sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-配置sonarqube"}},[a._v("#")]),a._v(" 2.3.3 配置sonarqube")]),a._v(" "),t("p",[a._v("选择自动安装 版本选择4.0")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172632014.png",alt:"image-20210701172632014"}})]),a._v(" "),t("p",[a._v("去sonarqube生成一个token")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701173002630.png",alt:"image-20210701173002630"}})]),a._v(" "),t("p",[a._v("在jenkins配置sonarqube的token")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701173142754.png",alt:"image-20210701173142754"}})]),a._v(" "),t("h4",{attrs:{id:"_2-3-4-配置maven"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-配置maven"}},[a._v("#")]),a._v(" 2.3.4 配置maven")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172734324.png",alt:"image-20210701172734324"}})]),a._v(" "),t("p",[a._v("进入系统配置页面"),t("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configure",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132:8080/jenkins/configure"),t("OutboundLink")],1)]),a._v(" "),t("h3",{attrs:{id:"_2-4-系统配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-系统配置"}},[a._v("#")]),a._v(" 2.4 系统配置")]),a._v(" "),t("h4",{attrs:{id:"_2-4-1配置sonarqube"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1配置sonarqube"}},[a._v("#")]),a._v(" 2.4.1配置sonarqube")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105600086.png",alt:"image-20210702105600086"}})]),a._v(" "),t("p",[a._v("token选择2.3.3中配置的token")]),a._v(" "),t("h4",{attrs:{id:"_2-4-2配置gitee"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2配置gitee"}},[a._v("#")]),a._v(" 2.4.2配置gitee")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105813187.png",alt:"image-20210702105813187"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105724228.png",alt:"image-20210702105724228"}})]),a._v(" "),t("p",[a._v("配置令牌之后在job中不能选择使用, 还是需要gitee的账号密码来验证,   好像这个gitee APIV5 token没有任何作用,  这一点有待验证")]),a._v(" "),t("h2",{attrs:{id:"_3-测试job"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试job"}},[a._v("#")]),a._v(" 3.测试Job")]),a._v(" "),t("p",[a._v("新建一个任务, 选择free style项目")]),a._v(" "),t("blockquote",[t("p",[a._v("demo项目地址"),t("a",{attrs:{href:"https://gitee.com/ytg2097/gitee-ci.git",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://gitee.com/ytg2097/gitee-ci.git"),t("OutboundLink")],1)])]),a._v(" "),t("h3",{attrs:{id:"_3-1-general"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-general"}},[a._v("#")]),a._v(" 3.1 General")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702110423395.png",alt:"image-20210702110423395"}})]),a._v(" "),t("h3",{attrs:{id:"_3-2-源码管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-源码管理"}},[a._v("#")]),a._v(" 3.2 源码管理")]),a._v(" "),t("p",[a._v("gitee链接选择"),t("a",{attrs:{href:"####2.4.2%E9%85%8D%E7%BD%AEgitee"}},[a._v("2.4.2")]),a._v("中配置的gitee地址")]),a._v(" "),t("p",[a._v("源码管理中Repository URL填写你的git项目地址;  Credentials添加一个全局的username类型凭证, 填写git账号密码")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111208008.png",alt:"image-20210702111208008"}})]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111314695.png",alt:"image-20210702111314695"}})]),a._v(" "),t("h3",{attrs:{id:"_3-3-构建环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-构建环境"}},[a._v("#")]),a._v(" 3.3 构建环境")]),a._v(" "),t("p",[a._v("构建环境中选择之前配置的maven settings文件")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111418234.png",alt:"image-20210702111418234"}})]),a._v(" "),t("h3",{attrs:{id:"_3-4-构建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-构建"}},[a._v("#")]),a._v(" 3.4 构建")]),a._v(" "),t("p",[a._v("构建步骤中新增三个步骤: shell  -  SonarqubeScanner - shell.  三个步骤顺序不能错, 因为Sonnar需要扫描classes目录, 如果没有在sonar扫描之前进行maven打包操作的话会报如下错误")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702153858954.png",alt:"image-20210702153858954"}})]),a._v(" "),t("h4",{attrs:{id:"_3-4-1-maven-打包命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-maven-打包命令"}},[a._v("#")]),a._v(" 3.4.1 maven 打包命令")]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("mvn clean "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -Dmaven.test.skip"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154106607.png",alt:"image-20210702154106607"}})]),a._v(" "),t("h4",{attrs:{id:"_3-4-2-sonarqube-scanner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-sonarqube-scanner"}},[a._v("#")]),a._v(" 3.4.2 sonarqube scanner")]),a._v(" "),t("p",[a._v("sonar scanner步骤中的Analysis properties根据实际情况填写以下内容, 其他内容不用填, 默认就可以")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154307169.png",alt:"image-20210702154307169"}})]),a._v(" "),t("div",{staticClass:"language-properties line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-properties"}},[t("code",[t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.projectKey")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("ci-test.cn    ")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.projectName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("ci-test      ")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.projectVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("1.0")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.sources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("src")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.java.binaries")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("target/classes")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("sonar.language")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token attr-value"}},[a._v("java")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("h4",{attrs:{id:"_3-4-3-启动jar"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-启动jar"}},[a._v("#")]),a._v(" 3.4.3  启动jar")]),a._v(" "),t("p",[a._v("最后一步启动jar , 在shell步骤中根据需求填写shell命令就可以, 这里直接执行项目中内置的sh")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154351765.png",alt:"image-20210702154351765"}})]),a._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/sh")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" start.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" stop.sh\n./stop.sh\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"先停止"')]),a._v("\n./start.sh\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"后启动"')]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("全部配置完成后保存然后执行一下试试")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154658738.png",alt:"image-20210702154658738"}})]),a._v(" "),t("p",[a._v("浏览器访问测试")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154734434.png",alt:"image-20210702154734434"}})]),a._v(" "),t("p",[a._v("去sonar看一下扫描结果")]),a._v(" "),t("p",[t("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702112427317.png",alt:"image-20210702112427317"}})]),a._v(" "),t("h2",{attrs:{id:"_4-后语"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-后语"}},[a._v("#")]),a._v(" 4. 后语")]),a._v(" "),t("p",[a._v("后面会再更新一篇云服务器环境搭建, 以及容器应用的自动化部署")])])}),[],!1,null,null,null);s.default=n.exports}}]);