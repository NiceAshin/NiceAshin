(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{463:function(a,s,t){"use strict";t.r(s);var e=t(2),n=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"从零开始搭建一条jenkins自动化部署流水线"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从零开始搭建一条jenkins自动化部署流水线"}},[a._v("#")]),a._v(" 从零开始搭建一条jenkins自动化部署流水线")]),a._v(" "),s("h2",{attrs:{id:"_0-前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_0-前言"}},[a._v("#")]),a._v(" 0. 前言")]),a._v(" "),s("p",[a._v("本次流水线搭建目标实现:   代码检查-代码打包-部署 三步自动化.")]),a._v(" "),s("h2",{attrs:{id:"_1-环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境搭建"}},[a._v("#")]),a._v(" 1. 环境搭建")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("服务器: 一台centos7.8虚拟机, IP: 192.168.58.132")]),a._v(" "),s("blockquote",[s("p",[a._v("本地调试用, 一台就够, 资源充足可以多台")])])]),a._v(" "),s("li",[s("p",[a._v("环境: "),s("code",[a._v("jdk1.8")]),a._v(", "),s("code",[a._v("maven3.5.2")]),a._v(", "),s("code",[a._v("jenkins2.289.1")]),a._v(", "),s("code",[a._v("sonarqube8.2")]),a._v(", "),s("code",[a._v("docker")]),a._v(", "),s("code",[a._v("docker-copmpose")])])])]),a._v(" "),s("h3",{attrs:{id:"_1-1-安装jdk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-安装jdk"}},[a._v("#")]),a._v(" 1.1 安装jdk")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" java-1.8.0-openjdk-devel.x86_64\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("java")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-version")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_1-2-安装maven"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装maven"}},[a._v("#")]),a._v(" 1.2 安装maven")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://repos.fedorapeople.org"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v(". "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" /etc/yum.repos.d/epel-apache-maven.repo\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-O")]),a._v(" /etc/yum.repos.d/epel-apache-maven.repo\nyum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" apache-maven\nmvn "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("h3",{attrs:{id:"_1-3-安装git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-安装git"}},[a._v("#")]),a._v(" 1.3 安装git")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("h3",{attrs:{id:"_1-4-安装jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-安装jenkins"}},[a._v("#")]),a._v(" 1.4 安装jenkins")]),a._v(" "),s("p",[a._v("这里直接使用war启动jenkins , 可以使用"),s("code",[a._v("java -jar")]),a._v("命令, 也可以使用tomcat启动. 这次我用的是tomcat")]),a._v(" "),s("blockquote",[s("p",[a._v("jenkins.war"),s("a",{attrs:{href:"https://get.jenkins.io/war-stable/2.289.2/jenkins.war",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载地址"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("启动后访问"),s("a",{attrs:{href:"http://192.168.58.132:8080/jenkins",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132:8080/jenkins"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("插件直接安装jenkins建议安装的插件, 如果有安装失败就重启jenkins几次.")]),a._v(" "),s("p",[a._v("默认密码在/var/jenkins_home/secrets/initialAdminPassword,  直接cat获取")]),a._v(" "),s("h3",{attrs:{id:"_1-5-安装sonarqube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-安装sonarqube"}},[a._v("#")]),a._v(" 1.5 安装sonarqube")]),a._v(" "),s("p",[a._v("先安装docker和docker-compose")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\t\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" systemctl start "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" https://download.fastgit.org/docker/compose/releases/download/1.27.4/docker-compose-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("-"),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-m")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/local/bin/docker-compose\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/docker-compose\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" version\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("再启动sonarqube")]),a._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"3.7"')]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonarqube"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("8.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("community\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" db\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"9000:9000"')]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_URL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" jdbc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("5432/sonar\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_USERNAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("SONAR_JDBC_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/data\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_extensions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/extensions\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/logs\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarqube_temp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/opt/sonarqube/temp\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("db")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" postgres\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" sonarnet\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("POSTGRES_USER")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("POSTGRES_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" sonar\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" postgresql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/postgresql\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" postgresql_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/var/lib/postgresql/data\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarnet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" bridge\n     \n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_extensions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_logs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("sonarqube_temp")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("postgresql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("postgresql_data")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br")])]),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("docker-compose")]),a._v(" up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("blockquote",[s("p",[a._v("如果启动几秒后发现sonarqube报错: "),s("code",[a._v("max virtual memory areas vm.max_map_count [65530] is too low, increase to at least")]),a._v("执行以下命令然后重启容器")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sysctl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-w")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("vm.max_map_count")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("262144")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])]),a._v(" "),s("h4",{attrs:{id:"汉化sonarqube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#汉化sonarqube"}},[a._v("#")]),a._v(" 汉化sonarqube")]),a._v(" "),s("p",[a._v("先下载汉化包插件"),s("a",{attrs:{href:"https://image.ytg2097.com/sonar-l10n-zh-plugin-1.16.jar",target:"_blank",rel:"noopener noreferrer"}},[a._v("点我获取"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("查找sonarqube插件的挂载路径, docker默认卷存放位置在/var/lib/docker/volumes/下, 如果按照上述安装步骤一直进行的话, sonarqube容器的插件包路径应该在宿主机的"),s("code",[a._v("/var/lib/docker/volumes/sonar_sonarqube_extensions/_data/plugins")]),a._v("下, 将下载好的jar放着这里")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701170352931.png",alt:"image-20210701170352931"}})]),a._v(" "),s("p",[a._v("然后重启再次访问"),s("a",{attrs:{href:"http://192.168.58.132/9000",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132/9000"),s("OutboundLink")],1),a._v(", 可以看到汉化成功")]),a._v(" "),s("h2",{attrs:{id:"_2-配置jenkins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置jenkins"}},[a._v("#")]),a._v(" 2.配置jenkins")]),a._v(" "),s("h3",{attrs:{id:"_2-1-下载插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-下载插件"}},[a._v("#")]),a._v(" 2.1 下载插件")]),a._v(" "),s("p",[a._v("进入插件"),s("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/pluginManager/available",target:"_blank",rel:"noopener noreferrer"}},[a._v("搜索页面"),s("OutboundLink")],1),a._v(", 分别搜索gitee, sonarqube scanner, Config File Provider, 然后安装")]),a._v(" "),s("h3",{attrs:{id:"_2-2-新增maven-settings文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-新增maven-settings文件"}},[a._v("#")]),a._v(" 2.2 新增maven settings文件")]),a._v(" "),s("p",[a._v("进入"),s("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configfiles/selectProvider",target:"_blank",rel:"noopener noreferrer"}},[a._v("配置文件管理页面"),s("OutboundLink")],1),a._v(", 选择Maven settings.xml, 然后submit, 在编辑页面里的content框中粘贴进去你的settings.xml配置然后submit")]),a._v(" "),s("h3",{attrs:{id:"_2-3-全局配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-全局配置"}},[a._v("#")]),a._v(" 2.3 全局配置")]),a._v(" "),s("p",[a._v("进入"),s("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configureTools/",target:"_blank",rel:"noopener noreferrer"}},[a._v("全局工具配置页面"),s("OutboundLink")],1)]),a._v(" "),s("h4",{attrs:{id:"_2-3-1-配置java"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-配置java"}},[a._v("#")]),a._v(" 2.3.1 配置java")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172410009.png",alt:"image-20210701172410009"}})]),a._v(" "),s("h4",{attrs:{id:"_2-3-2-配置git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-配置git"}},[a._v("#")]),a._v(" 2.3.2 配置git")]),a._v(" "),s("p",[a._v("git直接默认配置就好")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172526943.png",alt:"image-20210701172526943"}})]),a._v(" "),s("h4",{attrs:{id:"_2-3-3-配置sonarqube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-配置sonarqube"}},[a._v("#")]),a._v(" 2.3.3 配置sonarqube")]),a._v(" "),s("p",[a._v("选择自动安装 版本选择4.0")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172632014.png",alt:"image-20210701172632014"}})]),a._v(" "),s("p",[a._v("去sonarqube生成一个token")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701173002630.png",alt:"image-20210701173002630"}})]),a._v(" "),s("p",[a._v("在jenkins配置sonarqube的token")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701173142754.png",alt:"image-20210701173142754"}})]),a._v(" "),s("h4",{attrs:{id:"_2-3-4-配置maven"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-配置maven"}},[a._v("#")]),a._v(" 2.3.4 配置maven")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210701172734324.png",alt:"image-20210701172734324"}})]),a._v(" "),s("p",[a._v("进入系统配置页面"),s("a",{attrs:{href:"http://192.168.58.132:8080/jenkins/configure",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://192.168.58.132:8080/jenkins/configure"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"_2-4-系统配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-系统配置"}},[a._v("#")]),a._v(" 2.4 系统配置")]),a._v(" "),s("h4",{attrs:{id:"_2-4-1配置sonarqube"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1配置sonarqube"}},[a._v("#")]),a._v(" 2.4.1配置sonarqube")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105600086.png",alt:"image-20210702105600086"}})]),a._v(" "),s("p",[a._v("token选择2.3.3中配置的token")]),a._v(" "),s("h4",{attrs:{id:"_2-4-2配置gitee"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-2配置gitee"}},[a._v("#")]),a._v(" 2.4.2配置gitee")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105813187.png",alt:"image-20210702105813187"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702105724228.png",alt:"image-20210702105724228"}})]),a._v(" "),s("p",[a._v("配置令牌之后在job中不能选择使用, 还是需要gitee的账号密码来验证,   好像这个gitee APIV5 token没有任何作用,  这一点有待验证")]),a._v(" "),s("h2",{attrs:{id:"_3-测试job"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试job"}},[a._v("#")]),a._v(" 3.测试Job")]),a._v(" "),s("p",[a._v("新建一个任务, 选择free style项目")]),a._v(" "),s("blockquote",[s("p",[a._v("demo项目地址"),s("a",{attrs:{href:"https://gitee.com/ytg2097/gitee-ci.git",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://gitee.com/ytg2097/gitee-ci.git"),s("OutboundLink")],1)])]),a._v(" "),s("h3",{attrs:{id:"_3-1-general"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-general"}},[a._v("#")]),a._v(" 3.1 General")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702110423395.png",alt:"image-20210702110423395"}})]),a._v(" "),s("h3",{attrs:{id:"_3-2-源码管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-源码管理"}},[a._v("#")]),a._v(" 3.2 源码管理")]),a._v(" "),s("p",[a._v("gitee链接选择"),s("a",{attrs:{href:"####2.4.2%E9%85%8D%E7%BD%AEgitee"}},[a._v("2.4.2")]),a._v("中配置的gitee地址")]),a._v(" "),s("p",[a._v("源码管理中Repository URL填写你的git项目地址;  Credentials添加一个全局的username类型凭证, 填写git账号密码")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111208008.png",alt:"image-20210702111208008"}})]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111314695.png",alt:"image-20210702111314695"}})]),a._v(" "),s("h3",{attrs:{id:"_3-3-构建环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-构建环境"}},[a._v("#")]),a._v(" 3.3 构建环境")]),a._v(" "),s("p",[a._v("构建环境中选择之前配置的maven settings文件")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702111418234.png",alt:"image-20210702111418234"}})]),a._v(" "),s("h3",{attrs:{id:"_3-4-构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-构建"}},[a._v("#")]),a._v(" 3.4 构建")]),a._v(" "),s("p",[a._v("构建步骤中新增三个步骤: shell  -  SonarqubeScanner - shell.  三个步骤顺序不能错, 因为Sonnar需要扫描classes目录, 如果没有在sonar扫描之前进行maven打包操作的话会报如下错误")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702153858954.png",alt:"image-20210702153858954"}})]),a._v(" "),s("h4",{attrs:{id:"_3-4-1-maven-打包命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-maven-打包命令"}},[a._v("#")]),a._v(" 3.4.1 maven 打包命令")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("mvn clean "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-Dmaven.test.skip")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("true\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154106607.png",alt:"image-20210702154106607"}})]),a._v(" "),s("h4",{attrs:{id:"_3-4-2-sonarqube-scanner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-sonarqube-scanner"}},[a._v("#")]),a._v(" 3.4.2 sonarqube scanner")]),a._v(" "),s("p",[a._v("sonar scanner步骤中的Analysis properties根据实际情况填写以下内容, 其他内容不用填, 默认就可以")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154307169.png",alt:"image-20210702154307169"}})]),a._v(" "),s("div",{staticClass:"language-properties line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.projectKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ci-test.cn    ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.projectName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("ci-test      ")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.projectVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1.0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.sources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("src")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.java.binaries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("target/classes")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("sonar.language")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("java")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br")])]),s("h4",{attrs:{id:"_3-4-3-启动jar"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-启动jar"}},[a._v("#")]),a._v(" 3.4.3  启动jar")]),a._v(" "),s("p",[a._v("最后一步启动jar , 在shell步骤中根据需求填写shell命令就可以, 这里直接执行项目中内置的sh")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154351765.png",alt:"image-20210702154351765"}})]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/sh")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" start.sh\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("755")]),a._v(" stop.sh\n./stop.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"先停止"')]),a._v("\n./start.sh\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"后启动"')]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br")])]),s("p",[a._v("全部配置完成后保存然后执行一下试试")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154658738.png",alt:"image-20210702154658738"}})]),a._v(" "),s("p",[a._v("浏览器访问测试")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702154734434.png",alt:"image-20210702154734434"}})]),a._v(" "),s("p",[a._v("去sonar看一下扫描结果")]),a._v(" "),s("p",[s("img",{attrs:{src:"http://image.ytg2097.com/img/image-20210702112427317.png",alt:"image-20210702112427317"}})]),a._v(" "),s("h2",{attrs:{id:"_4-后语"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-后语"}},[a._v("#")]),a._v(" 4. 后语")]),a._v(" "),s("p",[a._v("后面会再更新一篇云服务器环境搭建, 以及容器应用的自动化部署")])])}),[],!1,null,null,null);s.default=n.exports}}]);